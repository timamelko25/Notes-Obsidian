https://habr.com/ru/articles/657677/

Виртуализация - сокрытие конкретной реализации за универсальным стандартизованным методом обращения к ресурсам. Иными словами, создание абстракции над аппаратным обеспечением

## Основные виды:
- Аппаратная виртуализация
Позволяет создать независимые и изолированные друг от друга виртуальные компьютеры с помощью программной имитации ресурсов (процессора, памяти, диска, etc) физического сервера. Физический сервер называют хостовой машиной (хостом), виртуальные компьютеры - виртуальными машинами. Программное обеспечение, которое создает виртуальные машины и управляет ими, называют гипервизором. 
- Виртуализация рабочих столов
Позволяет отделить логический рабочий стол (набор пользовательских программ, работающий под ОС) от физической инфраструктуры (например, ПК). Наиболее распространенной форм виртуализации рабочих столов является VDI (Virtual Desktop Infrastructure). Каждый пользователь VDI имеет программную имитацию ОС с необходимым набором программ на физическом сервере под управлением гипервизора и может подключаться к ней по сети.
- Виртуализация на уровне ОС (контейнеризация)
Позволяет запускать программное обеспечение  в изолированных на уровне ОС пространствах. Наиболее распространенной формой виртаулизации на уровне ОС являются контейнеры. Контейнеры более легковесны, чем виртуальные машины, так как они опираются на функционал ядра ОС и им не требуется взаимодействовать с аппаратным обеспечением.

## Виртуализация серверов

Виртуализация серверов - процесс разделения физического сервера на несколько уникальных и изолированных виртуальных машин (серверов) с помощью программного обеспечения (гипервизора). На каждом виртуальном сервер могут независимо выполняться собственные ОС.

Виртуализация серверов позволяет:
- Оптимизировать затраты на покупку серверного оборудования
- Упростить сопровождение инфраструктуры
- Повысить отказоустойчивость инфраструктуры

В классическом подходе гипервизоры группируются по 2 типам: 
- гипервизоры первого типа запускаются непосредственно на аппаратном обеспечении компьютера
- гипервизор второго типа для работы необходимо наличие хостовой ОС

Сейчас классическая классификация имеет еще гибридный тип который сочетает в себе характеристики первого и второго типа

### Гипервизор native, bare-metal
Выполняется как контрольная программа непосредственно на аппаратной части компьютера и не требует ОС общего назначения. В данной архитектуре гипервизор управляет распределением вычислительных ресурсов и сам контролирует все обращения виртуальных машин к устройствам. Имеют высокое быстродействие, из минусов - необходимость поддерживать драйвера устройств приводит к сужению списка совместимого аппаратного обеспечения

![[Pasted image 20250607171611.png]]

Пример гипервизоров:
- VMWare ESXi
- KVM (Proxmox VE) - также может быть использован как второй тип
- XEN (Xenserver, Citrix Hypervisor), Hyper-V - могут быть отнесены к гибридному типу

### Гипервизоры hosted

Выполняются поверх хостовой ОС. Управляется гостевыми ОС, в то время как эмуляцией и управлением физическими ресурсами занимается хостовая ОС. Показывают меньшее быстродействие относительно первого типа и меньше используются в промышленности, но легче использовать для разработки ПО.

![[Pasted image 20250607173438.png]]

Пример гипервозоров:
- Oracle VM VirualBox, VMWare Workstation
- KVM (Proxmox VE) - может быть отнесен к первому типу

### Гипервизоры hybrid

Сочетает в себе характеристики первого и второго типов - выполняется поверх специализированной сервисной (или базовой) ОС. Сервисная ОС называется родительским разделом или доменом (parent partition в терминологии Hyper-V или domain dom0 в терминологии Xen). После установки гипервизора ядро ОС переходит в режим поддержки виртуализации и передает управление ресурсами процессора и памяти гипервизору. При этом родительский раздел берет на себя функцию обработки обращений к драйверам устройств и операциям ввод-вывода. Подходит с точки зрения совместимости с оборудованием.

![[Pasted image 20250607173714.png]]

Примеры гипервизоров:
- Xen (XensServer, Citrix Hypervisor), Hyper-V - могут быть отнесены к первому типу

## Кластер узлов виртуализации

Кластер узлов виртуализации - объединение группы физических серверов, которое представляется конечным потребителям как общий вычислительный ресурс с единой точкой управлении. При этом виртуальные машины запускаются на разных физических серверах и могут перемещаться (мигрировать) между ними, что обеспечивает высокую доступность (High Availability) и гибкое распределение ресурсов (нагрузки)

## Виртуализация хранилища

Сочетает в себе функции физических устройств хранения данных, как сетевые устройства хранения данных (NAS) и сети хранения данных (SAN). 

## Виртаулизация сети

Процесс объединения всех сетевых ресурсов (корпоративные коммутаторы, маршрутизаторы, брандмауэры) для обеспечения централизованного выполнения административных задач. 
### Программно-определяемые сети

Программно-определяемые сети (SDN) управляют маршрутизацией трафика, принимая управление маршрутизацией из маршрутизации данных в физической среде. Можно переопределить приоритет обрабатываемого трафика

### Виртуализация сетевых функций

Технология виртуализации сетевых функций сочетает в себе функции таких сетевых устройств, как брандмауэры, балансировщики нагрузки и анализаторы трафика, работающие вместе для повышения производительности сети.

## Виртуализация данных

Виртуализация данных создает программный уровень между локальными и облачными данными и приложениями. Инструменты виртуализации данных обрабатывают запросы данных приложений и возвращают результаты в подходящем формате

## Контейнеры
Контейнеризация (виртуализация на уровне ОС) - технология, которая позволяет запускать программное обеспечение в изолированных на уровне ОС пространствах. 

### Механизмы изоляции контейнеров
Изоляция процессов в контейнерах осуществляется благодаря 2-ум механизмам ядра Linux - пространства имен (namespaces) и контрольным группам (cgroups). 

Пространства имен гарантирует, что процесс будет работать с с собственным представлением системы. Существует несколько типов пространств имен:
- файловая система (mount, mnt) - изолирует файловую систему
- UTS (UNIX Time-Sharing, uts) -  изолирует hostname и доменное имя
- идентификатор процессов (process identifier, pid) - изолирует процессы
- сеть (network, net) - изолирует сетевые интерфейсы
- межпроцессное взаимодействие (ipc) - изолирует конкурирующее взаимодействие процессами
- пользовательские идентификаторы (user) - изолирует ID пользователей и групп
Процесс принадлежит не одному пространству имен, а одному пространству имен каждого типа

Контрольные группы гарантируют, что процесс не будет конкурировать за ресурсы, зарезервированные за другими процессами. Они ограничивают (контролируют) объем ресурсов, который процесс может потреблять - ЦПУ, ОЗУ, пропускную способность сети

### Используемые технологии для изоляции

1. `Chroot Jail` - считается одной из первых технологий контейнеризации. Позволяет изолировать процесс и его дочерние элементы от остальной части операционной системы. Проблема, что корневой процесс может легко выйти из chroot 
2. `FreeBSD Jail` - в отличии от `Chroot Jail` также изолирует процессы и их действия от файловой системы
![[Pasted image 20250607213658.png]]
3. `CGroups` - механизм который изолирует использование ресурсов для набора процессов. 

Виртуальные машины могут быть
- System Virtual Machines (системными)
- Process Virtual Machines (процессными) иногда Application (вм приложения)

В повседневном использовании под виртуальной машиной подразумевается системная виртуальная машина,  которая представляет собой эмуляцию всей ОС. Однако процессная используется для имитации среды программирования для выполнения отдельного процесса 

`runc` - CLI для непосредственного использования `libcontainer` без использования Docker Engine.

`Containerd` - полностью поддерживает запуск пакетов OCI (Open Container Initiative) и управление их жизненным циклом. Использует runc для запуска контейнеров, но реализует также другие высокоуровневые функции, такие как управление образами и высокоуровневые API. 