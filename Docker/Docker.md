
Docker - платформа, предназначенная для разработки, развертывания и запуска приложений в виртуальных контейнерах.

Виртуальная машина и контейнер

Виртуальная машина

Виртуальная машина (VM) - абстрактная вычислительная среда, которая создаётся программным способом на физическом оборудовании и имитирует компьютер или сервер с полноценной операционной системой и аппаратным обеспечением. Является эмуляцией реального компьютера, работают поверх физической машины с помощью HyperVisor

HyperVisor (гипервизор) - часть программного обеспечения, прошивки или оборудования на котором работают виртуальные машины. HyperV работает на физических компьютерах, называемых "хост-машиной". Хост-машина предоставляет виртуальным машинам ресурсы компьютера (ЦП, Оперативная память). Виртуальная машина работающая на хост-машине называется "гостевой машиной". Гостевая машина содержит в себе приложения, двоичные файлы, библиотеки, виртуализированный аппаратный стек, включая виртуализированные сетевые адаптеры , хранилище, ЦП - есть полноценная гостевая ОС.

Гостевая машина может работать на размещенном HyperV, так и на bare-metal HyperV.

HyperV

Размещенный гипервизор виртуализации работает на ОС хост-машины. У виртуальной машины нет прямого доступа к оборудования, поэтому она должна проходить через хост-ОС.

Преимущества размещенного гипервизора: базовое оборудование менее важно. ОС хоста отвечает за драйвера оборудования, а не за сам гипервизор и поэтому считается более "совместимой с оборудованием".
С другой стороны это дополнительный слой между оборудованием и гипервизором создает больше накладных расходов ресурсов

![[Pasted image 20250319150133.png]]

Bare-metal HyperV

Решение проблемы производительности: среда гипервизора ставится на оборудование хост-машины и работает с него. Работает напрямую с оборудованием, не нужна ОС хоста. Теперь первое что ставится в качестве ОС будет гипервизор. Такой гипервизор имеет собственные драйвера устройств и взаимодействуют с каждым компонентом напрямую для любых задач ввода-вывода, обработки или ОС. Это обеспечивает лучшую производительность, масштабируемость и стабильность, но совместимость с оборудованием ограничена, поскольку гипервизор может иметь только определенное количество встроенных драйверов.

!написать про гипер в [Архитектура Hyper-V: Глубокое погружение / Хабр](https://habr.com/ru/articles/98580/)

Контейнер

Контейнер - изолированное пространство, которое позволяет запускать приложения с их зависимостями отдельно от основной системы. Так же является запускаемым экземпляром класса

Преимущества:
- Автономный. Каждый контейнер имеет все необходимое для функционирования без зависимости от каких-либо предустановленных зависимостей на хост-машине
- Изолированный. Минимальное влияние на хост машину и другие контейнеры
- Независимый. 
- Портативный. 

Недостатки:
- Зависимость от ядра ОС, что может ограничивать использование технологий
- Сложная реализация оркестрации, необходимость использовать дополнительное ПО (Kubernetes)
- Безопасность. Проверка сторонних образов из общедоступных реестров 

Docker используется для создания и управления контейнерами, обеспечивая их изоляцию и быструю настройку.
Kubernetes занимает оркестрацией, помогая управлять множеством контейнеров, распределяя нагрузку и поддерживая высокую доступность сервисов.

В отличии от виртуальной машины, которая обеспечивает аппаратную виртуализацию, контейнер обеспечивает виртуализацию на уровне ОС, абстрагируя "пространство пользователя"
Имеют частное пространство для обработки, выполнение команды от root, частный сетевой интерфейс и IP-адрес, допускают пользовательские маршруты и правила iptable (контроль входящего и исходящего трафика, проброс портов), могут монтировать файловые системы..

Большое различие VM и контейнера: контейнер использует ядро хост-системы совместно с другими контейнерами.
![[Pasted image 20250319152346.png]]

Контейнер упаковывает только пользовательское пространство, а не ядро или виртуальное оборудование. Каждый контейнер получает собственное пользовательское пространство 

Docker Engine
Движок Docker - клиент-серверное приложение
Слой на котором работает Docker. Это среда выполнения и инструментарий, который управляет контейнерами, образами, сборками...

Состоит из:
- Docker Daemon
- Клиент Docker взаимодействует с Docker Daemon для выполнения команд
- REST API для удаленного взаимодействия с Docker Daemon

Клиент Docker
Конечный инструмент для взаимодействия с пользователем. Может работать на хост-машине, но необязательно. Может работать на другой машине и обращаться с Docker Daemon, который работает на хост-машине

Docker Daemon
Демон Docker - это сервер ожидающий команд отправленных от клиента к API Docker, например, сборка, запуск распространение контейнеров. Работает на хост-машине.

Клиент и демон Docker взаимодействуют с помощью REST API через сокеты UNIX или сетевой интерфейс.

Другой клиент Docker - Docker Compose, который позволяет работать с приложениями, состоящими из набора контейнеров.

Docker Registry - хранит образы Docker. Docker Hub - публичный реестр, который может использовать любой, можно запустить частный реестр.
![[Pasted image 20250319164004.png]]

Dockerfile
Место для описании инструкции по созданию образа Docker

Docker Image (образ докера)
Образ - шаблон доступный только для чтения, который создается из набора инструкций Dockerfile.
Образ определяет упакованное приложение и его зависимости, а так же какие процессы должны запускаться при его запуске. Каждая инструкция в Dockerfile добавляет новый слой к образу, причем слои представляют собой часть файловой системы образов, которая добавляет, либо заменяет слой под ним. Для управления слоев Docker использует Union File System.
!!!!!!!!!!!!Union file system можно представить как стековую файловую систему, то есть файлы и каталоги отдельных файловых систем (известных как ветви) могут быть прозрачно наложены друг на друга для формирования единой файловой системы. (система копирования при записи)

Преимущества многоуровневых систем:
- Отсутствие дублирования. Соли помогают избежать дублирования полного набора файлов каждый раз, когда используется образ для создания и запуска нового контейнера
- Разделение слоев. При изменении образа Docker распространяет обновления только на тот слой, который был изменен

Тома Docker (Docker Volumes)
Предпочтительны механизм постоянного хранения данных, потребляемых или производимых приложениями. Тома данных отделены от стандартной файловой системы Union File System и существуют как обычные каталоги и файлы в файловой системе хоста
